<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusAI - Transform Your Campus Life</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Font Awesome (for icons) and Lucide (for form icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* ---------------------- CUSTOM CSS STYLES ---------------------- */

        /* Variables for easy theme changes */
        :root {
            --primary-color: #5d3fd3;
            /* Vibrant Purple */
            --secondary-color: #8a2be2;
            /* Blue-Violet */
            --accent-purple: #9333ea;
            --text-dark: #1f2937;
            --text-light: #4b5563;
            --card-background: #ffffff;
            --border-color: #e5e7eb;
            --shadow-color: rgba(0, 0, 0, 0.05);
            /* NEW: Digital gradient background */
            --body-bg-gradient: linear-gradient(135deg, #e0f2f1 0%, #b3e5fc 50%, #e1bee7 100%);
            --header-bg: rgba(255, 255, 255, 0.9);
        }

        /* Base Styles and Typography */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--body-bg-gradient);
            transition: background-color 0.3s;
            min-height: 100vh;
        }

        h1,
        h2 {
            color: var(--text-dark);
            font-weight: 700;
        }

        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 1.75rem;
        }

        p {
            color: var(--text-light);
        }

        /* Utility Classes */
        .section-divider {
            border: none;
            height: 1px;
            background-color: var(--border-color);
            margin: 4rem auto;
            width: 90%;
            max-width: 1200px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            margin: 0 auto;
            width: 100%;
            /* NEW: Semi-transparent background for header */
            background-color: var(--header-bg);
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 800;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            color: var(--primary-color);
            padding-left: 0;
            border: 2px solid transparent;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            background-color: transparent;
        }

        .logo i {
            margin-right: 0.5rem;
            font-size: 1.75rem;
        }

        /* Fixed Position Profile Icon Style (Wrapper for Icon + Dropdown) */
        .profile-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 900;
            width: 40px;
            height: 40px;
            background-color: white;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.15s;
            overflow: hidden;
        }

        .profile-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-icon:hover {
            background-color: #f0f0ff;
        }

        /* Dropdown Menu Style (GitHub-like) */
        .profile-dropdown {
            position: fixed;
            top: 65px;
            right: 20px;
            width: 250px;
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 0.5rem 0;
            display: none;
            z-index: 950;
        }

        .dropdown-item {
            display: block;
            padding: 0.5rem 1rem;
            font-size: 0.95rem;
            color: var(--text-dark);
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.15s;
        }

        .dropdown-item:hover {
            background-color: #f0f0ff;
        }

        /* Primary Button Styles (for header and hero) */
        .primary-btn {
            display: inline-block;
            text-decoration: none;
            text-align: center;
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
        }

        .primary-btn:hover {
            background-color: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(93, 63, 211, 0.4);
            transform: translateY(-2px);
        }

        /* Secondary Button (Learn More) */
        .secondary-btn {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        .secondary-btn:hover {
            background-color: rgba(93, 63, 211, 0.1);
        }

        /* Main Content Layout */
        main {
            padding-top: 5rem;
            /* Offset for fixed header */
            margin: 0 auto;
            width: 100%;
        }

        /* Hero Section - New Three-Column Layout */
        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            /* Text | Visual | Card */
            align-items: center;
            gap: 2rem;
            padding: 2rem 5% 4rem;
            /* Adjusted for new fixed header */
            max-width: 1200px;
            margin: 0 auto;
            min-height: 80vh;
        }

        .hero-content {
            text-align: left;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            line-height: 1.1;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        /* STYLING FOR TRANSFORM YOUR CAMPUS LIFE */
        .hero-content h1 span {
            color: var(--accent-purple);
            text-shadow: 0 0 8px rgba(147, 51, 234, 0.6), 0 0 1px rgba(147, 51, 234, 0.4);
        }

        .hero-content .description {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            justify-content: flex-start;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem 1rem;
            background-color: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            max-width: 300px;
        }

        .stats-grid div {
            text-align: center;
        }

        .stats-grid strong {
            font-size: 1.4rem;
            display: block;
            color: var(--primary-color);
        }

        /* Central Visualization Column */
        .hero-visualization {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            height: 400px;
        }

        .brain-viz {
            width: 100%;
            height: 100%;
            max-width: 450px;
            border-radius: 50%;
            background-image: url("https://placehold.co/400x400/8a2be2/ffffff?text=AI+Brain+Visual");
            background-size: cover;
            box-shadow: 0 0 40px rgba(138, 43, 226, 0.5);
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
                box-shadow: 0 0 30px rgba(138, 43, 226, 0.4);
            }

            to {
                transform: scale(1.05);
                box-shadow: 0 0 50px rgba(138, 43, 226, 0.7);
            }
        }


        /* AI Dashboard Card Column */
        .hero-dashboard-card {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            padding: 1rem;
            transform: translateY(-20px);
        }

        .dashboard-card-content {
            width: 100%;
            height: 90%;
            background-color: var(--accent-purple);
            color: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .dashboard-card-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }

        .dashboard-feature-row {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1rem;
        }

        .dashboard-feature-item {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dashboard-feature-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* New styles for functional dashboard content */
        .dashboard-metric {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dashboard-metric:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .metric-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 0.25rem;
        }

        .metric-value {
            font-size: 1rem;
            font-weight: 600;
        }


        /* Features Section */
        .features-section {
            padding: 2rem 5%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .feature-card {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -2px var(--shadow-color);
            transition: transform 0.3s ease;
            border: 1px solid var(--border-color);
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .icon-box {
            width: 48px;
            height: 48px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .feature-card h2 {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        .feature-card p {
            font-size: 0.95rem;
        }

        /* Call to Action Banner */
        .cta-banner {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            text-align: center;
            padding: 3rem 2rem;
            border-radius: 16px;
            margin: 4rem auto;
            width: 90%;
            max-width: 1200px;
        }

        .cta-banner h2 {
            color: white;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .cta-banner p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
        }

        .cta-btn {
            background-color: white;
            color: var(--primary-color);
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .cta-btn:hover {
            transform: scale(1.05);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem 5%;
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--header-bg);
            margin: 2rem auto 0;
            width: 100%;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 5%;
        }

        .footer-logo {
            justify-content: center;
            margin-bottom: 0.5rem;
            border: 2px solid transparent;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            background-color: transparent;
        }

        footer p {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        /* Floating AI Bot Button */
        .ai-bot {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            cursor: grab;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: box-shadow 0.2s;
            z-index: 999;
            user-select: none;
            align-items: center;
        }

        /* Tooltip for AI Bot */
        .ai-bot::before {
            content: "Ask me anything!";
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%) translateX(-10px);
            padding: 5px 10px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 0.875rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            z-index: 1000;
        }

        .ai-bot:hover::before {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(0);
        }

        .ai-bot:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* ---------------------- MODAL STYLES ---------------------- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .form-card {
            max-width: 440px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        /* Styles for Auth Form Tabs */
        .tab-button {
            transition: all 0.2s ease-in-out;
            font-weight: 600;
            color: #4b5563;
        }

        .tab-button.active {
            color: #1f2937;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .input-field:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .hero-section {
                /* Collapse to two columns on smaller screens */
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
                padding: 4rem 5%;
                min-height: auto;
            }

            .hero-visualization {
                grid-column: 1 / span 2;
                /* Full width for visualization */
                order: 1;
                height: 300px;
            }

            .hero-content {
                order: 2;
                text-align: left;
                grid-column: 1 / span 1;
            }

            .hero-dashboard-card {
                order: 3;
                grid-column: 2 / span 1;
                height: 300px;
                transform: translateY(0);
                /* Remove lift on smaller screens for layout stability */
            }

            .hero-content h1 {
                font-size: 3rem;
            }

            .hero-buttons {
                margin-bottom: 2rem;
            }

            .stats-grid {
                max-width: none;
            }

            .features-section {
                padding: 2rem 5%;
            }
        }

        @media (max-width: 600px) {
            header {
                padding: 1rem 3%;
            }

            main {
                padding-top: 4rem;
                /* Adjust for smaller header on mobile */
            }

            .hero-section {
                /* Collapse to single column on mobile */
                grid-template-columns: 1fr;
                padding: 4rem 3%;
                gap: 2rem;
            }

            .hero-visualization {
                order: 1;
                grid-column: 1;
                height: 250px;
            }

            .hero-content {
                order: 2;
                grid-column: 1;
                text-align: center;
            }

            .hero-dashboard-card {
                order: 3;
                grid-column: 1;
                height: 250px;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .hero-buttons {
                flex-direction: column;
                gap: 0.75rem;
                justify-content: center;
                align-items: center;
                margin-bottom: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                padding: 1rem;
                margin: 0 auto;
            }

            .cta-banner h2 {
                font-size: 1.5rem;
            }

            .features-section {
                padding: 2rem 3%;
            }

            footer {
                padding: 2rem 3%;
            }

            /* Adjust fixed icon positions slightly */
            .profile-icon {
                top: 10px;
                right: 10px;
            }
        }

        /* New style for task item priority display */
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            background-color: #f9fafb;
            margin-bottom: 0.5rem;
            transition: background-color 0.2s;
        }

        .task-item:hover {
            background-color: #f3f4f6;
        }

        .task-item.high-priority {
            border-left: 4px solid #ef4444;
            /* Red for High */
        }

        .task-item.low-priority {
            border-left: 4px solid #3b82f6;
            /* Blue for Low */
        }

        /* Style for the quiz choice buttons */
        .quiz-choice {
            background-color: #f0f0ff;
            /* Light purple/indigo background */
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            transition: all 0.2s;
        }

        .quiz-choice:hover {
            background-color: #e0e0ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>

    <!-- ---------------------- FIXED PROFILE ICON AND DROPDOWN ---------------------- -->
    <div id="profile-icon" class="profile-icon hidden" onclick="toggleDropdown()">
        <i class="fas fa-user text-primary-color text-lg"></i>
    </div>

    <!-- GitHub-style Profile Dropdown -->
    <div id="profile-dropdown" class="profile-dropdown">

        <!-- User Info Section -->
        <div class="px-3 py-2 border-b border-border-color">
            <p id="dropdown-username" class="font-semibold text-sm">John Student</p>
            <p id="dropdown-email" class="text-xs text-gray-500 truncate" title="john.student@university.edu">
                john.student@university.edu</p>
        </div>

        <!-- Links Section -->
        <a href="javascript:void(0)" class="dropdown-item" onclick="openSettingsModal(); closeDropdown();">
            <i class="fas fa-cog mr-2"></i> Profile Settings
        </a>
        <a href="javascript:void(0)" class="dropdown-item"
            onclick="showMessage('View Dashboard (Simulated)'); closeDropdown();">
            <i class="fas fa-chart-line mr-2"></i> Dashboard
        </a>

        <!-- Sign Out -->
        <a href="javascript:void(0)" class="dropdown-item border-t border-border-color mt-1"
            onclick="handleSignOut(); closeDropdown();">
            <i class="fas fa-sign-out-alt mr-2"></i> Sign Out
        </a>
    </div>


    <!-- ---------------------- LANDING PAGE HEADER ---------------------- -->
    <header>
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>CampusAI</span>
        </div>

        <!-- Get Started Button (Visible before login) -->
        <a href="javascript:void(0)" id="get-started-btn" onclick="openAuthModal()" class="primary-btn">
            Get Started →
        </a>
    </header>

    <!-- ---------------------- MAIN CONTENT ---------------------- -->
    <main>
        <section class="hero-section">

            <!-- 1. TEXT & BUTTONS COLUMN (Left) -->
            <div class="hero-content">
                <p class="tagline">✦ Your Smart Campus Companion</p>
                <h1>Transform Your <span>Campus Life</span></h1>
                <p class="description">
                    Your AI powered assistant for seamless academic organization and success.
                </p>

                <div class="hero-buttons">
                    <button class="primary-btn" onclick="openAuthModal()">START FREE TRIAL</button>
                    <button class="secondary-btn" onclick="openAuthModal()">LEARN MORE</button>
                </div>

                <!-- 4. STATS GRID (Moved inside hero-content for responsiveness) -->
                <div class="stats-grid">
                    <div><strong>10K+</strong> Active Students</div>
                    <div><strong>500+</strong> Campus Events</div>
                    <div><strong>24/7</strong> AI Support</div>
                    <div><strong>99%</strong> Satisfaction</div>
                </div>
            </div>

            <!-- 2. VISUALIZATION COLUMN (Center) -->
            <div class="hero-visualization">
                <!-- UPDATED: Added click handler for AI Visualization feature -->
                <div class="brain-viz cursor-pointer" onclick="showAIVisualization()"></div>
            </div>

            <!-- 3. AI DASHBOARD CARD (Right) -->
            <div class="hero-dashboard-card">
                <div class="dashboard-card-content">
                    <h3 class="text-white">AI DASHBOARD</h3>
                    <p class="text-xs text-white opacity-80 mb-4">
                        Unlock your potential with personalized insights.
                    </p>

                    <!-- DYNAMIC CHART AREA -->
                    <div id="dashboard-charts" class="flex-grow">
                        <!-- Content injected by JavaScript -->
                    </div>

                    <!-- Simulated Feature Icons -->
                    <div class="dashboard-feature-row">
                        <div class="dashboard-feature-item" onclick="showMessage('Navigating to Notes!')">
                            <i class="fas fa-file-alt text-white opacity-80"></i> Notes
                        </div>
                        <div class="dashboard-feature-item" onclick="showMessage('Opening Schedule...')">
                            <i class="fas fa-calendar-day text-white opacity-80"></i> Schedule
                        </div>
                        <div class="dashboard-feature-item" onclick="showMessage('Checking Alerts...')">
                            <i class="fas fa-bell text-white opacity-80"></i> Alerts
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <hr class="section-divider">

        <section class="features-section">
            <div class="feature-grid">
                <!-- Features (Content is retained from previous version) -->
                <!-- UPDATED: AI-Powered Tasks -->
                <div class="feature-card" onclick="showAITasks()">
                    <div class="icon-box" style="background-color: #9333ea;"><i class="fas fa-brain"></i></div>
                    <h2>AI-Powered Tasks</h2>
                    <p>Smart task management with AI-generated schedules and prioritization.</p>
                </div>
                <div class="feature-card" onclick="openChatbotModal()">
                    <div class="icon-box" style="background-color: #3b82f6;"><i class="fas fa-headset"></i></div>
                    <h2>24/7 AI Assistant</h2>
                    <p>Get instant help with academic doubts and study tips anytime.</p>
                </div>
                <!-- UPDATED FEATURE CARD TO CALL showClubsMainOptions() -->
                <div class="feature-card" onclick="showClubsMainOptions()">
                    <div class="icon-box" style="background-color: #10b981;"><i class="fas fa-calendar-alt"></i></div>
                    <h2>Events & Clubs</h2>
                    <p>Stay updated with campus events, seminars, and club activities.</p>
                </div>
                <!-- UPDATED FEATURE CARD TO CALL showFocusEnhancement() -->
                <div class="feature-card" onclick="showFocusEnhancement()">
                    <div class="icon-box" style="background-color: #f97316;"><i class="fas fa-hourglass-start"></i>
                    </div>
                    <h2>Focus Enhancement</h2>
                    <p>Boost productivity with focus timers and study recommendations.</p>
                </div>
                <div class="feature-card" onclick="showMessage('Viewing Smart Notes...')">
                    <div class="icon-box" style="background-color: #8b5cf6;"><i class="fas fa-book-open"></i></div>
                    <h2>Smart Notes</h2>
                    <p>Organize and access AI-generated study notes based on your syllabus.</p>
                </div>
                <!-- UPDATED FEATURE CARD TO CALL showCampusMap() -->
                <div class="feature-card" onclick="showCampusMap()">
                    <div class="icon-box" style="background-color: #06b6d4;"><i class="fas fa-map-marked-alt"></i></div>
                    <h2>Campus Navigation</h2>
                    <p>Interactive maps for classrooms, libraries, and important locations.</p>
                </div>

                <!-- Additional Features -->
                <div class="feature-card" onclick="showMessage('Accessing Wellness Resources...')">
                    <div class="icon-box" style="background-color:#ef4444;"><i class="fas fa-heart"></i></div>
                    <h2>Mental Health Support</h2>
                    <p>AI-driven guidance, stress management tips, and access to counselors.</p>
                </div>
                <div class="feature-card" onclick="showMessage('Generating Timetable...')">
                    <div class="icon-box" style="background-color:#16a34a;"><i class="fas fa-calendar-check"></i></div>
                    <h2>Personalized Timetable</h2>
                    <p>Auto-generated class & study schedule tailored to your syllabus.</p>
                </div>
                <div class="feature-card" onclick="showMessage('Starting Practice Quiz...')">
                    <div class="icon-box" style="background-color:#facc15; color:#000;"><i class="fas fa-pen-alt"></i>
                    </div>
                    <h2>Exam Preparation Assistant</h2>
                    <p>AI-generated quizzes, flashcards, and practice tests based on your syllabus.</p>
                </div>
                <div class="feature-card" onclick="showMessage('Opening Expense Tracker...')">
                    <div class="icon-box" style="background-color:#22c55e;"><i class="fas fa-wallet"></i></div>
                    <h2>Finance & Expense Tracker</h2>
                    <p>Manage your expenses with AI-powered budgeting and savings tips.</p>
                </div>
                <div class="feature-card" onclick="showMessage('Connecting to Admin Services...')">
                    <div class="icon-box" style="background-color:#3b82f6;"><i class="fas fa-university"></i></div>
                    <h2>Campus Services Simplified</h2>
                    <p>One-click access to cafeteria menus, hostel info, and admin services.</p>
                </div>
            </div>
        </section>

        <hr class="section-divider">

        <section class="cta-banner">
            <h2>Ready to Transform Your Campus Experience?</h2>
            <p>Join thousands of students already using CampusAI to achieve more</p>
            <a href="javascript:void(0)" onclick="openAuthModal()" class="cta-btn">Get Started Free ⟳</a>
        </section>
    </main>

    <!-- ---------------------- FOOTER ---------------------- -->
    <footer>
        <div class="logo footer-logo">
            <i class="fas fa-graduation-cap"></i>
            <span>CampusAI</span>
        </div>

        <p>© 2025 CampusAI. Making campus life smarter, one student at a time.</p>
    </footer>

    <!-- Floating AI Bot Button (DRAGGABLE) -->
    <div id="ai-bot-icon" class="ai-bot" onclick="handleBotClick()">
        <i class="fas fa-robot"></i>
    </div>

    <!-- ---------------------- MODAL AREA ---------------------- -->

    <!-- 1. AUTHENTICATION MODAL -->
    <div id="auth-modal" class="modal">
        <!-- Close button (uses Lucide icon) -->
        <button onclick="closeAuthModal()"
            class="absolute top-4 right-4 text-white hover:text-gray-200 focus:outline-none z-10">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>

        <!-- Login Form Card -->
        <div class="form-card bg-white p-8 sm:p-10 rounded-xl relative">
            <div class="text-center mb-8">
                <!-- Icon: Graduation Cap (uses Lucide icon) -->
                <div class="inline-flex p-3 bg-indigo-100 rounded-full mb-4">
                    <i data-lucide="graduation-cap" class="w-6 h-6 text-indigo-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Campus GPT</h1>
                <p class="text-sm text-gray-500">Your AI-powered campus assistant</p>
            </div>

            <!-- Tabs -->
            <div class="flex bg-gray-100 p-1 rounded-lg mb-8" id="auth-tabs">
                <button id="signin-tab" class="tab-button active flex-1 py-2" onclick="switchView('signin')">Sign
                    In</button>
                <button id="signup-tab" class="tab-button flex-1 py-2" onclick="switchView('signup')">Sign Up</button>
            </div>

            <!-- Form -->
            <form id="auth-form" onsubmit="handleAuth(event)">
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="email" name="email" placeholder="student@university.edu" required
                        class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg outline-none transition duration-150">
                </div>

                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" name="password" required
                        class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg outline-none transition duration-150">
                </div>

                <button type="submit" id="submit-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition duration-150 shadow-md shadow-blue-300/50">
                    Sign In
                </button>

                <p id="message" class="text-center mt-4 text-sm"></p>
            </form>
        </div>
    </div>

    <!-- 2. PROFILE SETTINGS MODAL (FULL SCREEN FOR EDITING) -->
    <div id="settings-modal" class="modal">
        <button onclick="closeSettingsModal()"
            class="absolute top-4 right-4 text-white hover:text-gray-200 focus:outline-none z-10">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>

        <div class="form-card bg-white p-8 sm:p-10 rounded-xl relative">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold text-gray-800">Profile Settings</h1>
                <p class="text-sm text-gray-500">Update your personal and academic details.</p>
            </div>

            <form id="profile-form" onsubmit="saveProfile(event)">

                <!-- Profile Picture Upload -->
                <div class="mb-6 text-center">
                    <div id="profile-picture-display"
                        class="w-24 h-24 mx-auto bg-gray-200 rounded-full flex items-center justify-center mb-3 cursor-pointer hover:bg-gray-300 transition"
                        onclick="document.getElementById('profile-picture-input').click()">
                        <i class="fas fa-camera text-gray-600 text-xl"></i>
                    </div>
                    <input type="file" id="profile-picture-input" class="hidden" accept="image/*"
                        onchange="previewProfilePicture(event)">
                    <label class="text-sm font-medium text-gray-700">Change Photo</label>
                </div>

                <!-- Full Name -->
                <div class="mb-4">
                    <label for="full-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="full-name" name="fullName" placeholder="Jane Doe" required
                        class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg outline-none transition duration-150">
                </div>

                <!-- College Name -->
                <div class="mb-4">
                    <label for="college-name" class="block text-sm font-medium text-gray-700 mb-1">College Name</label>
                    <input type="text" id="college-name" name="collegeName" placeholder="Tech University of Campus"
                        class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg outline-none transition duration-150">
                </div>

                <!-- Branch/Major -->
                <div class="mb-6">
                    <label for="branch-major" class="block text-sm font-medium text-gray-700 mb-1">Branch/Major</label>
                    <input type="text" id="branch-major" name="branchMajor" placeholder="Computer Science"
                        class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg outline-none transition duration-150">
                </div>

                <button type="submit"
                    class="w-full bg-primary-color hover:bg-secondary-color text-white font-semibold py-3 rounded-lg transition duration-150 shadow-md shadow-purple-300/50">
                    Save Changes
                </button>
            </form>
            <p id="profile-message" class="text-center mt-4 text-sm"></p>
        </div>
    </div>

    <!-- 3. CHATBOT MODAL -->
    <div id="chatbot-modal" class="modal">
        <!-- Close button -->
        <button onclick="closeChatbotModal()"
            class="absolute top-4 right-4 text-white hover:text-gray-200 focus:outline-none z-10">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>

        <div class="form-card bg-white p-6 sm:p-8 rounded-xl relative max-w-lg w-full h-3/4 flex flex-col">
            <div class="text-center mb-4 border-b pb-3">
                <h2 class="text-xl font-bold text-gray-800">CampusAI Chatbot</h2>
                <p class="text-sm text-gray-500">Ask me anything about your campus life!</p>
            </div>

            <!-- Chat History -->
            <div id="chat-history" class="flex-grow overflow-y-auto space-y-4 p-2 mb-4 bg-gray-50 rounded-lg">
                <!-- Initial AI Message -->
                <div class="flex justify-start">
                    <div
                        class="bg-indigo-100 text-indigo-800 p-3 rounded-xl rounded-bl-none max-w-[80%] shadow-sm text-sm">
                        Hi there! I'm your CampusAI Assistant. How can I help you today?
                    </div>
                </div>
                <!-- Messages will be injected here -->
            </div>

            <!-- Chat Input Form -->
            <form onsubmit="handleChatSubmit(event)" class="flex gap-2">
                <input type="text" id="chat-input" placeholder="Type your message..." required
                    class="input-field flex-grow px-4 py-2 border border-gray-300 rounded-lg outline-none transition duration-150">
                <button type="submit"
                    class="bg-primary-color hover:bg-secondary-color text-white font-semibold py-2 px-4 rounded-lg transition duration-150">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- 4. DASHBOARD DETAILS MODAL (USED FOR METRICS AND CLUBS/TASKS) -->
    <div id="details-modal" class="modal">
        <button onclick="closeDetailsModal()"
            class="absolute top-4 right-4 text-white hover:text-gray-200 focus:outline-none z-10">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>

        <div class="form-card bg-white p-8 sm:p-10 rounded-xl relative max-w-xl w-11/12">
            <div class="text-center mb-6">
                <h2 id="details-title" class="text-2xl font-bold text-gray-800 mb-1">Metric Details</h2>
                <p id="details-subtitle" class="text-sm text-gray-500">In-depth analysis of your metric.</p>
            </div>

            <div id="details-content" class="space-y-4">
                <!-- Detailed content injected here -->
            </div>

            <div class="mt-6 text-center">
                <button onclick="closeDetailsModal()" class="primary-btn px-6 py-2">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- ---------------------- JAVASCRIPT ---------------------- -->
    <script>
        // Global variables to store user state (Simulated)
        let user = {
            name: "John Student",
            email: "john.student@university.edu",
            profilePicUrl: null // Stores data URL if uploaded
        };

        // NEW: Global object to store user club preferences
        let userInterests = {
            tech: 0,
            creative: 0,
            community: 0,
            lastUpdated: null,
            quizAnswers: {} // To store raw answers for the current session
        };

        // Global array to store custom tasks
        let customTasks = [
            { id: 1, text: "Finish CS Lab Report on sorting algorithms", priority: "high" },
            { id: 2, text: "Email group members about presentation", priority: "low" },
            { id: 3, text: "Review History 201 notes for quiz", priority: "high" },
        ];


        // MOCK DATA: Dashboard Metrics
        const MOCK_DASHBOARD_DATA = [
            {
                id: 'deadline', label: 'Upcoming Deadline', value: 'CS 101 Assignment', type: 'date', icon: 'fas fa-calendar-alt',
                details: "The 'Intro to Algorithms' assignment on Sorting is due next Tuesday at 11:59 PM. Recommended preparation time: 6 hours."
            },

            {
                id: 'progress', label: 'Avg. Course Progress', value: '78%', type: 'progress', icon: 'fas fa-chart-bar',
                details: "Your average completion across 5 active courses is 78%. History 201 is lagging at 62%. Focus time is recommended."
            },

            {
                id: 'focus', label: 'Study Focus Time', value: '4.5 hrs this week', type: 'time', icon: 'fas fa-hourglass-start',
                details: "You spent 4.5 hours in deep focus this week, a 15% increase from last week. Keep up the consistent effort!"
            },
        ];

        // CLUB DATA STRUCTURE
        const CLUB_DATA = {
            '🚀 Career & Entrepreneurship': [
                { name: 'Innovators Hub', desc: 'For startup ideas and entrepreneurship', tags: ['biz'] },
                { name: 'Tech Titans', desc: 'Coding, AI, and hackathons', tags: ['tech'] },
                { name: 'Finance League', desc: 'Stock market and investment discussions', tags: ['biz'] },
                { name: 'Legal Minds Society', desc: 'Law and ethics awareness', tags: ['biz'] },
                { name: 'EcoVision Club', desc: 'Sustainability and environmental innovation', tags: ['community'] },
                { name: 'BizSpark Club', desc: 'Business and management enthusiasts', tags: ['biz'] },
                { name: 'Math Mavericks', desc: 'Puzzles, logic, and problem-solving challenges', tags: ['biz'] },
            ],
            '💻 Creative & Media Clubs': [
                { name: 'Pixel Palette', desc: 'Graphic design and digital art', tags: ['creative'] },
                { name: 'Film & Photography Club', desc: 'Cinematography and photo contests', tags: ['creative'] },
                { name: 'Literary Circle', desc: 'Writing, poetry, and book discussions', tags: ['creative'] },
                { name: 'Drama Society (The Stage Crew)', desc: 'Acting and short plays', tags: ['creative'] },
                { name: 'Music Vibes', desc: 'Singing, instruments, and jamming sessions', tags: ['creative'] },
                { name: 'Dance Dynasty', desc: 'All forms of dance and choreography', tags: ['creative'] },
                { name: 'Creative Corner', desc: 'DIY, crafts, and event decoration', tags: ['creative'] },
            ],
            '🌍 Cultural & Community Clubs': [
                { name: 'Cultural Fusion Club', desc: 'Fest celebrations and diversity promotion', tags: ['community'] },
                { name: 'Language Lounge', desc: 'Learn and share global languages', tags: ['community'] },
                { name: 'Community Care Club', desc: 'Social work and volunteering', tags: ['community'] },
                { name: 'Peace & Humanity Club', desc: 'Awareness campaigns and charity drives', tags: ['community'] },
                { name: 'Heritage Society', desc: 'Promote local art and traditions', tags: ['community'] },
            ],
            '🧠 Wellness & Personal Growth': [
                { name: 'MindSpace Club', desc: 'Mental health and emotional well-being', tags: ['wellness'] },
                { name: 'Fitness & Sports Club', desc: 'Gym, yoga, and outdoor games', tags: ['wellness', 'community'] },
                { name: 'Strategic Minds', desc: 'Chess, esports, and mind games', tags: ['tech'] },
                { name: 'Public Speaking & Debate Club', desc: 'Confidence building and discussions', tags: ['biz', 'wellness'] },
            ],
            '🤖 Innovation & Exploration': [
                { name: 'Robotics League', desc: 'Build and compete with robots', tags: ['tech'] },
                { name: 'AI & Data Science Club', desc: 'Machine learning and analytics', tags: ['tech'] },
                { name: 'Astronomy Explorers', desc: 'Stargazing and space research', tags: ['tech', 'community'] },
                { name: 'CyberSec Warriors', desc: 'Cybersecurity and ethical hacking', tags: ['tech'] },
            ],
            '🎉 Fun & Lifestyle': [
                { name: 'Event Mavericks', desc: 'Manage college events, fests, and hackathons', tags: ['biz', 'community'] },
            ],
        };

        const QUIZ_QUESTIONS = [
            {
                id: 'q1',
                text: "Do you enjoy **coding, robotics, or complex technology**?",
                choices: [
                    { label: "Yes, I love tech and algorithms!", value: 'tech', weight: 1 },
                    { label: "No, I prefer non-tech skills.", value: 'none', weight: 0 }
                ]
            },
            {
                id: 'q2',
                text: "Are you drawn to **art, design, music, or performing arts**?",
                choices: [
                    { label: "Yes, I'm creative and expressive!", value: 'creative', weight: 1 },
                    { label: "No, I lean towards structure and analysis.", value: 'none', weight: 0 }
                ]
            },
            {
                id: 'q3',
                text: "Do you prefer **social work, volunteering, or physical outdoor activities**?",
                choices: [
                    { label: "Yes, I like community and movement.", value: 'community', weight: 1 },
                    { label: "No, I prefer quiet, cerebral hobbies.", value: 'none', weight: 0 }
                ]
            }
        ];
        // Note: The 'biz' tag is considered the default for all non-selected categories.


        // Modal elements
        const authModal = document.getElementById('auth-modal');
        const settingsModal = document.getElementById('settings-modal');
        const chatbotModal = document.getElementById('chatbot-modal');
        const detailsModal = document.getElementById('details-modal');
        const profileDropdown = document.getElementById('profile-dropdown');
        const body = document.body;

        // Auth elements
        const signInTab = document.getElementById('signin-tab');
        const signUpTab = document.getElementById('signup-tab');
        const submitBtn = document.getElementById('submit-btn');
        const messageEl = document.getElementById('message');
        const getStartedBtn = document.getElementById('get-started-btn');
        const profileIcon = document.getElementById('profile-icon');
        let currentView = 'signin';

        // Profile elements
        const profileMessageEl = document.getElementById('profile-message');
        const profilePicDisplay = document.getElementById('profile-picture-display');
        const dropdownUsernameEl = document.getElementById('dropdown-username');
        const dashboardChartsEl = document.getElementById('dashboard-charts');

        // Details Modal elements
        const detailsTitleEl = document.getElementById('details-title');
        const detailsSubtitleEl = document.getElementById('details-subtitle');
        const detailsContentEl = document.getElementById('details-content');

        // Chatbot elements
        const chatHistory = document.getElementById('chat-history');
        const aiBotIcon = document.getElementById('ai-bot-icon');

        // Draggable state variables
        let isDragging = false;
        let dragOffsetX, dragOffsetY;
        let wasDragged = false;


        /**
         * Toggles the visibility of header elements based on login status.
         */
        function toggleHeaderControls(isLoggedIn) {
            if (isLoggedIn) {
                profileIcon.classList.remove('hidden');
                getStartedBtn.style.visibility = 'hidden'; // Hide the Get Started button in the header
                getStartedBtn.style.pointerEvents = 'none';
            } else {
                profileIcon.classList.add('hidden');
                getStartedBtn.style.visibility = 'visible'; // Show the Get Started button
                getStartedBtn.style.pointerEvents = 'auto';
            }
        }

        /**
         * Utility to display temporary success/error messages in a toast.
         */
        function showMessage(text) {
            const tempMessageEl = document.createElement('div');
            tempMessageEl.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-xl z-[1001] transition duration-300 opacity-0';
            tempMessageEl.textContent = text;
            body.appendChild(tempMessageEl);

            // Fade in
            setTimeout(() => tempMessageEl.style.opacity = '1', 10);

            // Fade out and remove
            setTimeout(() => {
                tempMessageEl.style.opacity = '0';
                setTimeout(() => body.removeChild(tempMessageEl), 500);
            }, 3000);
        }

        /**
         * Loads and injects mock data into the AI Dashboard card.
         */
        function loadDashboardContent() {
            if (!dashboardChartsEl) return;

            dashboardChartsEl.innerHTML = MOCK_DASHBOARD_DATA.map(metric => `
                <div class="dashboard-metric" onclick="showMetricDetails('${metric.id}')">
                    <div class="metric-label flex items-center">
                        <i class="${metric.icon} mr-1"></i> ${metric.label}
                    </div>
                    <div class="metric-value">
                        ${metric.value}
                    </div>
                </div>
            `).join('');
        }

        /* --- DASHBOARD DETAILS MODAL FUNCTIONS (FOR METRICS) --- */

        window.showMetricDetails = function (metricId) {
            const metric = MOCK_DASHBOARD_DATA.find(m => m.id === metricId);
            if (!metric) return showMessage('Error: Metric not found.');

            detailsTitleEl.textContent = metric.label + " Analysis";
            detailsSubtitleEl.textContent = `Current Value: ${metric.value}`;

            detailsContentEl.innerHTML = `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="font-medium text-lg text-primary-color mb-2">AI Insight</p>
                    <p class="text-sm text-gray-700">${metric.details}</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="font-medium text-lg text-primary-color mb-2">Actionable Next Steps</p>
                    <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                        <li>Schedule 2 hours of focused study time.</li>
                        <li>Review notes from last week's lecture on ${metric.type === 'progress' ? 'History 201' : 'Algorithms'}.</li>
                        <li>Set a reminder for ${metric.type === 'date' ? 'Monday' : 'tomorrow'} at 6 PM.</li>
                    </ul>
                </div>
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }

        /**
         * Renders the custom task list sorted by priority.
         */
        function renderTasks() {
            // Sort: High priority first (string comparison: 'high' < 'low')
            const sortedTasks = customTasks.sort((a, b) => {
                if (a.priority === 'high' && b.priority === 'low') return -1;
                if (a.priority === 'low' && b.priority === 'high') return 1;
                return 0;
            });

            const tasksListHtml = sortedTasks.map(task => `
                <div class="task-item ${task.priority}-priority">
                    <div class="flex items-center space-x-3">
                        <i class="far fa-circle text-gray-400 text-sm cursor-pointer hover:text-green-500" onclick="completeTask(${task.id})"></i>
                        <span class="text-base text-gray-700">${task.text}</span>
                    </div>
                    <div class="text-xs font-semibold uppercase text-white px-2 py-1 rounded-full ${task.priority === 'high' ? 'bg-red-500' : 'bg-blue-500'}">
                        ${task.priority}
                    </div>
                </div>
            `).join('');

            return `
                <div class="bg-gray-100 p-4 rounded-lg max-h-[25vh] overflow-y-auto">
                    <p class="font-bold text-sm text-gray-600 mb-3">YOUR CUSTOM TO-DO LIST:</p>
                    ${tasksListHtml.length > 0 ? tasksListHtml : '<p class="text-sm text-gray-500 text-center py-4">No custom tasks added yet. Get started above!</p>'}
                </div>
            `;
        }

        /**
         * Handles adding a new custom task from the form.
         */
        window.addNewTask = function (event) {
            event.preventDefault();
            const taskInput = document.getElementById('new-task-text');
            const priorityInput = document.getElementById('new-task-priority');
            const taskText = taskInput.value.trim();
            const priority = priorityInput.value;

            if (taskText) {
                const newTask = {
                    id: Date.now(), // Use timestamp as unique ID
                    text: taskText,
                    priority: priority
                };
                customTasks.push(newTask);
                taskInput.value = ''; // Clear input
                showMessage(`Task added: "${taskText}" (${priority})`);

                // Re-render the task list section
                const taskListContainer = document.getElementById('custom-task-list');
                if (taskListContainer) {
                    taskListContainer.innerHTML = renderTasks();
                }
            } else {
                showMessage('Please enter a task description.');
            }
        }

        /**
         * Simulates completing a task.
         */
        window.completeTask = function (taskId) {
            const taskIndex = customTasks.findIndex(task => task.id === taskId);
            if (taskIndex !== -1) {
                const completedTask = customTasks[taskIndex].text;
                customTasks.splice(taskIndex, 1);
                showMessage(`Task completed: "${completedTask}"!`);

                // Re-render the task list section
                const taskListContainer = document.getElementById('custom-task-list');
                if (taskListContainer) {
                    taskListContainer.innerHTML = renderTasks();
                }
            }
        }


        /* --- AI VISUALIZATION MODAL FUNCTION --- */
        window.showAIVisualization = function () {
            detailsTitleEl.textContent = "CampusAI Core Intelligence";
            detailsSubtitleEl.textContent = "Real-time visualization of knowledge flow and personalized insights.";

            detailsContentEl.innerHTML = `
                <div class="space-y-4">
                    <div class="p-4 bg-indigo-50 border-t-4 border-indigo-500 rounded-lg shadow-inner">
                        <h3 class="font-bold text-lg text-indigo-800 flex items-center mb-1">
                            <i class="fas fa-network-wired mr-2"></i> Cognitive Load Analysis
                        </h3>
                        <p class="text-sm text-gray-700">
                            Your current AI network status is **Optimal (92% Efficiency)**. Key learning modules (Algorithms, History) show strong, interconnected data paths.
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 bg-white border rounded-lg shadow-sm">
                            <p class="text-xs text-gray-500">Active Connections</p>
                            <strong class="text-2xl text-green-600">3,401</strong>
                            <p class="text-xs text-green-500">↑ 14% from yesterday</p>
                        </div>
                        <div class="p-3 bg-white border rounded-lg shadow-sm">
                            <p class="text-xs text-gray-500">Data Processed (Last Hr)</p>
                            <strong class="text-2xl text-red-600">1.2 GB</strong>
                            <p class="text-xs text-red-500">High volume due to study session</p>
                        </div>
                    </div>

                    <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg">
                        <h3 class="font-bold text-lg text-gray-800 flex items-center mb-1">
                            <i class="fas fa-exclamation-triangle mr-2"></i> Insight Alert
                        </h3>
                        <p class="text-sm text-gray-700">
                            **Creative Writing module** shows low engagement. The system suggests joining the 'Literary Circle' club to boost this cognitive area.
                        </p>
                    </div>
                </div>
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }


        /* --- AI TASKS MODAL FUNCTION --- */
        window.showAITasks = function () {
            detailsTitleEl.textContent = "AI Task & Planner Hub";
            detailsSubtitleEl.textContent = "Use AI for instant planning or add your own prioritized tasks.";

            const aiTasks = [
                { name: "Generate Study Plan (Exam)", icon: "fas fa-clipboard-list", color: "bg-red-500", action: "Exam study plan generated" },
                { name: "Summarize Lecture Notes", icon: "fas fa-file-export", color: "bg-yellow-500", action: "Notes summary generated" },
                { name: "Prioritize To-Do List", icon: "fas fa-sort-amount-up-alt", color: "bg-green-500", action: "To-Do list prioritized" },
                { name: "Find Group Study Time", icon: "fas fa-users", color: "bg-indigo-500", action: "Group study time found" },
            ];

            const aiTaskHtml = `
                <div class="grid grid-cols-2 gap-4">
                    ${aiTasks.map(task => `
                        <button class="flex flex-col items-center justify-center p-4 rounded-xl text-white shadow-lg transform transition duration-200 hover:scale-[1.02] ${task.color} focus:outline-none"
                            onclick="showMessage('${task.action} (Simulated)'); closeDetailsModal();">
                            <i class="${task.icon} text-2xl mb-2"></i>
                            <span class="font-semibold text-sm text-center">${task.name}</span>
                        </button>
                    `).join('')}
                </div>
            `;

            const customTaskFormHtml = `
                <form onsubmit="addNewTask(event)" class="space-y-3 p-4 bg-white rounded-lg shadow-inner border border-gray-200">
                    <p class="font-bold text-base text-gray-800 border-b pb-2 mb-2">Add New Task</p>
                    <input type="text" id="new-task-text" placeholder="Enter task description (e.g., Read Chapter 5)" required
                        class="input-field w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    
                    <div class="flex items-center space-x-4">
                        <select id="new-task-priority" class="input-field px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            <option value="high">High Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                        <button type="submit" class="w-full bg-primary-color hover:bg-secondary-color text-white font-semibold py-2 rounded-lg text-sm">
                            Add Task
                        </button>
                    </div>
                </form>
            `;

            // Combine AI Tasks, Custom Form, and the rendered Task List
            detailsContentEl.innerHTML = `
                <div class="space-y-6 max-h-[70vh] overflow-y-auto pr-3">
                    <p class="font-bold text-sm text-gray-800">AI-ASSISTED FUNCTIONS:</p>
                    ${aiTaskHtml}
                    
                    <p class="font-bold text-sm text-gray-800 pt-4 border-t">MANUAL TASK ENTRY:</p>
                    ${customTaskFormHtml}

                    <div id="custom-task-list">
                        ${renderTasks()}
                    </div>
                </div>
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }


        /* --- FOCUS ENHANCEMENT MODAL FUNCTION --- */
        window.showFocusEnhancement = function () {
            detailsTitleEl.textContent = "Focus & Productivity Hub";
            detailsSubtitleEl.textContent = "Select a timer cycle to start deep work.";

            const cycles = [
                { name: "Pomodoro (25/5)", focus: 25, rest: 5, color: "bg-red-500", icon: "fas fa-clock" },
                { name: "Deep Work (50/10)", focus: 50, rest: 10, color: "bg-green-500", icon: "fas fa-brain" },
                { name: "Quick Burst (15/3)", focus: 15, rest: 3, color: "bg-blue-500", icon: "fas fa-bolt" },
            ];

            const cyclesHtml = `
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    ${cycles.map(cycle => `
                        <button class="flex flex-col items-center justify-center p-4 rounded-xl text-white shadow-lg transform transition duration-200 hover:scale-[1.02] ${cycle.color} focus:outline-none"
                            onclick="startFocusTimer(${cycle.focus}, ${cycle.rest}, '${cycle.name}'); closeDetailsModal();">
                            <i class="${cycle.icon} text-2xl mb-2"></i>
                            <span class="font-semibold text-sm text-center">${cycle.name}</span>
                            <span class="text-xs mt-1 opacity-80">${cycle.focus} min Focus / ${cycle.rest} min Break</span>
                        </button>
                    `).join('')}
                </div>
            `;

            const customTimerHtml = `
                <form id="custom-timer-form" onsubmit="handleCustomTimer(event)" class="space-y-3 p-4 bg-white rounded-lg shadow-inner border border-gray-200">
                    <p class="font-bold text-base text-gray-800 border-b pb-2 mb-2">Set Custom Timer</p>
                    <div class="flex space-x-4">
                        <input type="number" id="custom-focus" placeholder="Focus (min)" min="1" required
                            class="input-field flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                        <input type="number" id="custom-rest" placeholder="Break (min)" min="1" required
                            class="input-field flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    </div>
                    <button type="submit" class="w-full bg-primary-color hover:bg-secondary-color text-white font-semibold py-2 rounded-lg text-sm">
                        Start Custom Timer
                    </button>
                </form>
            `;

            detailsContentEl.innerHTML = `
                <div class="space-y-6 max-h-[70vh] overflow-y-auto pr-3">
                    <p class="font-bold text-sm text-gray-800">PRESET FOCUS CYCLES:</p>
                    ${cyclesHtml}
                    
                    <p class="font-bold text-sm text-gray-800 pt-4 border-t">CUSTOMIZE:</p>
                    ${customTimerHtml}
                    
                    <div class="mt-4 p-3 bg-indigo-50 border border-indigo-200 rounded-lg text-sm text-gray-700">
                        <i class="fas fa-lightbulb mr-2 text-indigo-500"></i>
                        Using structured time intervals like the Pomodoro Technique dramatically improves concentration and retention.
                    </div>
                </div>
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }

        // helper function to start timer (simulated)
        window.startFocusTimer = function (focusMinutes, restMinutes, name) {
            showMessage(`Starting ${name} cycle: ${focusMinutes} min Focus / ${restMinutes} min Break!`);
            // In a real app, this would initiate a setInterval or web worker timer.
        }

        // handler for custom form
        window.handleCustomTimer = function (event) {
            event.preventDefault();
            const focus = document.getElementById('custom-focus').value;
            const rest = document.getElementById('custom-rest').value;

            if (focus && rest) {
                startFocusTimer(parseInt(focus), parseInt(rest), `Custom (${focus}/${rest})`);
                closeDetailsModal();
            } else {
                showMessage('Please enter valid focus and break times.');
            }
        }


        /* --- CLUB OPTIONS AND QUIZ FUNCTIONS --- */

        window.showClubsMainOptions = function () {
            detailsTitleEl.textContent = "Campus Clubs & Societies Hub";
            detailsSubtitleEl.textContent = "How would you like to find your crew?";

            // Reset quiz answers before starting the main flow
            userInterests.quizAnswers = {};

            const lastUpdatedText = userInterests.lastUpdated
                ? `<p class="text-center text-sm text-gray-500 mt-4">Last preferences saved: ${userInterests.lastUpdated}.</p>`
                : '';

            detailsContentEl.innerHTML = `
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 p-4">
                    <button class="flex flex-col items-center justify-center p-6 bg-indigo-100 text-indigo-800 rounded-xl shadow-lg transform transition duration-200 hover:bg-indigo-200"
                        onclick="showManualClubJoin()">
                        <i class="fas fa-list-ul text-3xl mb-2"></i>
                        <span class="font-bold text-lg">Join Manually</span>
                        <span class="text-xs mt-1">Browse all available clubs by category.</span>
                    </button>
                    <button class="flex flex-col items-center justify-center p-6 bg-purple-100 text-purple-800 rounded-xl shadow-lg transform transition duration-200 hover:bg-purple-200"
                        onclick="showInterestQuestionnaire(0)">
                        <i class="fas fa-magic text-3xl mb-2"></i>
                        <span class="font-bold text-lg">Join by Interests (AI)</span>
                        <span class="text-xs mt-1">Answer 3 quick questions for personalized matches.</span>
                    </button>
                </div>
                ${lastUpdatedText}
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }

        window.showInterestQuestionnaire = function (qIndex) {
            if (qIndex >= QUIZ_QUESTIONS.length) {
                processQuestionnaire();
                return;
            }

            const question = QUIZ_QUESTIONS[qIndex];

            detailsTitleEl.textContent = `Interest Quiz (Question ${qIndex + 1} of ${QUIZ_QUESTIONS.length})`;
            detailsSubtitleEl.textContent = question.text;

            const choicesHtml = question.choices.map(choice => `
                <button class="w-full quiz-choice font-semibold py-3 rounded-lg text-sm mb-3"
                    onclick="recordAnswer('${question.id}', '${choice.value}', ${choice.weight}, ${qIndex})">
                    ${choice.label}
                </button>
            `).join('');

            detailsContentEl.innerHTML = `
                <div class="p-4">
                    ${choicesHtml}
                </div>
                <div class="mt-4 text-center text-sm text-gray-500">
                    Your answers help CampusAI recommend the perfect activities!
                </div>
            `;
        }

        window.recordAnswer = function (id, value, weight, qIndex) {
            userInterests.quizAnswers[id] = { value, weight };

            // Move to the next question
            showInterestQuestionnaire(qIndex + 1);
        }

        window.processQuestionnaire = function () {
            let scores = { tech: 0, creative: 0, community: 0, biz: 0 };
            const answers = userInterests.quizAnswers;

            // 1. Calculate weighted scores
            for (const key in answers) {
                if (answers[key].value !== 'none') {
                    scores[answers[key].value] += answers[key].weight;
                }
            }

            // 2. Update global interest scores (for future personalization)
            userInterests.tech = scores.tech;
            userInterests.creative = scores.creative;
            userInterests.community = scores.community;
            userInterests.lastUpdated = new Date().toLocaleDateString();

            // 3. Determine the primary interest(s)
            let maxScore = Math.max(scores.tech, scores.creative, scores.community);
            let suggestedTags = [];

            if (maxScore === 0) {
                // Default to Biz if no strong interest found
                suggestedTags = ['biz'];
                maxScore = 1;
            } else {
                if (scores.tech === maxScore) suggestedTags.push('tech');
                if (scores.creative === maxScore) suggestedTags.push('creative');
                if (scores.community === maxScore) suggestedTags.push('community');
            }

            // 4. Find matching clubs
            const recommendedClubs = [];
            for (const categoryKey in CLUB_DATA) {
                CLUB_DATA[categoryKey].forEach(club => {
                    if (club.tags.some(tag => suggestedTags.includes(tag)) && recommendedClubs.length < 5) {
                        if (!recommendedClubs.some(rc => rc.name === club.name)) {
                            recommendedClubs.push({ name: club.name, desc: club.desc, category: categoryKey.split(' ')[1] });
                        }
                    }
                });
            }

            // 5. Render Results
            detailsTitleEl.textContent = "Your AI Match Results 🎉";
            detailsSubtitleEl.textContent = `Based on your quiz, your primary interest is: ${suggestedTags.join(' & ').toUpperCase()}.`;

            let resultsHtml = recommendedClubs.length > 0 ? recommendedClubs.map(club => `
                <div class="p-4 border-l-4 border-primary-color bg-indigo-50 rounded-lg shadow-sm flex flex-col space-y-2">
                    <strong class="text-lg text-primary-color">${club.name}</strong>
                    <span class="text-sm text-gray-700">${club.desc}</span>
                    <span class="text-xs font-medium text-gray-500">Category: ${club.category}</span>
                    <div class="flex space-x-3 mt-2">
                        <button class="bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold hover:bg-green-600 transition"
                            onclick="showMessage('Joined ${club.name}! Welcome aboard!'); closeDetailsModal();">
                            Join Now <i class="fas fa-check ml-1"></i>
                        </button>
                        <button class="bg-gray-300 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold hover:bg-gray-400 transition"
                            onclick="showMessage('Saved ${club.name} for later consideration.'); closeDetailsModal();">
                            Save for Later
                        </button>
                    </div>
                </div>
            `).join('') : '<p class="text-center text-red-500 font-semibold p-4 border rounded-lg">Could not find a strong match. Try browsing manually!</p>';

            detailsContentEl.innerHTML = `
                <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-3">
                    <p class="font-bold text-sm text-gray-800">RECOMMENDED CLUBS (Top ${recommendedClubs.length}):</p>
                    ${resultsHtml}
                    <div class="text-center pt-4 border-t">
                         <button class="secondary-btn" onclick="showManualClubJoin()">Browse All Clubs</button>
                    </div>
                </div>
            `;
        }

        /* --- MANUAL CLUB JOIN FUNCTION (REFACTORED) --- */
        window.showManualClubJoin = function () {
            detailsTitleEl.textContent = "Manual Club Browser";
            detailsSubtitleEl.textContent = "Explore your passion and find your crew!";

            let contentHTML = '';
            const iconMap = {
                '🚀': '#5d3fd3',
                '💻': '#3b82f6',
                '🌍': '#10b981',
                '🧠': '#8b5cf6',
                '🤖': '#06b6d4',
                '🎉': '#f97316',
            };

            // Generate HTML for each category
            for (const categoryKey in CLUB_DATA) {
                // Extract icon from the category string (e.g., '🚀 Career...')
                const icon = categoryKey.substring(0, categoryKey.indexOf(' '));
                const categoryName = categoryKey.substring(categoryKey.indexOf(' ') + 1);
                const color = iconMap[icon] || '#5d3fd3';

                contentHTML += `
                    <div class="bg-white border-l-4 p-4 rounded-lg shadow-md" style="border-color: ${color};">
                        <h3 class="font-bold text-lg mb-2 flex items-center text-gray-800">
                            <span class="mr-2 text-xl">${icon}</span> ${categoryName}
                        </h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                `;

                CLUB_DATA[categoryKey].forEach(club => {
                    contentHTML += `
                        <li class="p-2 border-b last:border-b-0 hover:bg-gray-50 rounded-sm cursor-pointer" onclick="showMessage('Joining ${club.name} is simulated.')">
                            <strong class="text-primary-color">${club.name}</strong>
                            <span class="text-xs text-gray-500 block">${club.desc}</span>
                        </li>
                    `;
                });

                contentHTML += `
                        </ul>
                    </div>
                `;
            }

            detailsContentEl.innerHTML = `
                <div class="space-y-6 max-h-[60vh] overflow-y-auto pr-3">
                    ${contentHTML}
                </div>
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }

        /* --- CAMPUS NAVIGATION MAP MODAL FUNCTION --- */
        window.showCampusMap = function () {
            detailsTitleEl.textContent = "LPU Campus Navigation Map";
            detailsSubtitleEl.textContent = "Explore Lovely Professional University with 3D Navigation";

            detailsContentEl.innerHTML = `
                <div class="bg-gray-100 p-4 rounded-lg text-center">
                    <img src="https://placehold.co/500x300/4c1d95/ffffff?text=LPU+Campus+Map+Simulation" 
                        alt="LPU Campus Map Placeholder" class="w-full h-auto rounded-lg mb-3 mx-auto shadow-lg">
                    <p class="text-sm text-gray-700 font-semibold mb-2">Interactive Navigation (Simulated)</p>
                    <p class="text-xs text-gray-500">Find your way to Block 3, Central Library, or the Uni-Mall instantly. Tap on any area for localized details and live crowd density updates.</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="font-medium text-lg text-primary-color mb-2">Key Highlights</p>
                    <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                        <li>3D View of all academic and residential blocks.</li>
                        <li>Live directions to the nearest cafeteria.</li>
                        <li>Integrated bus shuttle tracking (Simulated).</li>
                        <li>Bookmark your favorite classrooms.</li>
                    </ul>
                </div>
            `;

            detailsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }


        window.closeDetailsModal = function () {
            detailsModal.style.display = 'none';
            body.style.overflow = 'auto';
        }

        /* --- GLOBAL DROPDOWN/MODAL CLOSURE --- */
        // Closes dropdown when clicking outside
        document.addEventListener('click', (event) => {
            const isOutsideIcon = !profileIcon.contains(event.target);
            const isOutsideDropdown = !profileDropdown.contains(event.target);

            if (isOutsideIcon && isOutsideDropdown) {
                closeDropdown();
            }
        });

        /* --- DRAGGABLE AI BOT FUNCTIONS --- */

        aiBotIcon.addEventListener('mousedown', (e) => {
            isDragging = true;
            wasDragged = false;
            aiBotIcon.style.cursor = 'grabbing';
            aiBotIcon.style.transition = 'none';

            const rect = aiBotIcon.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;

            aiBotIcon.style.position = 'fixed';
            aiBotIcon.style.transform = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            let newX = e.clientX - dragOffsetX;
            let newY = e.clientY - dragOffsetY;

            const botWidth = aiBotIcon.offsetWidth;
            const botHeight = aiBotIcon.offsetHeight;

            newX = Math.min(Math.max(0, newX), window.innerWidth - botWidth);
            newY = Math.min(Math.max(0, newY), window.innerHeight - botHeight);

            aiBotIcon.style.left = `${newX}px`;
            aiBotIcon.style.top = `${newY}px`;
            aiBotIcon.style.right = 'auto'; // Disable right property

            // If the mouse moved beyond a threshold, consider it a drag
            if (Math.abs(e.movementX) > 1 || Math.abs(e.movementY) > 1) {
                wasDragged = true;
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                aiBotIcon.style.cursor = 'pointer';
                aiBotIcon.style.transition = 'box-shadow 0.2s'; // Re-enable transition
            }
        });

        // This function handles both click (open modal) and drag events
        window.handleBotClick = function () {
            if (!wasDragged) {
                openChatbotModal();
            }
            // Reset wasDragged flag after processing click
            wasDragged = false;
        }

        /* --- AUTH MODAL FUNCTIONS --- */

        function openAuthModal() {
            authModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }

        function closeAuthModal() {
            authModal.style.display = 'none';
            body.style.overflow = 'auto';
        }

        function switchView(view) {
            currentView = view;
            if (view === 'signin') {
                signInTab.classList.add('active');
                signUpTab.classList.remove('active');
                submitBtn.textContent = 'Sign In';
            } else {
                signUpTab.classList.add('active');
                signInTab.classList.remove('active');
                submitBtn.textContent = 'Sign Up';
            }
            messageEl.textContent = '';
        }

        function handleAuth(e) {
            e.preventDefault();

            messageEl.textContent = currentView === 'signin' ? 'Signing in...' : 'Creating account...';
            messageEl.className = 'text-center mt-4 text-sm text-blue-600';

            setTimeout(() => {
                const action = currentView === 'signin' ? 'Signed In' : 'Account Created';
                messageEl.textContent = `Successfully ${action} (Simulated)!`;
                messageEl.className = 'text-center mt-4 text-sm text-green-600';

                toggleHeaderControls(true);
                updateProfileIcon(); // Update icon after login
                setTimeout(closeAuthModal, 1500);
            }, 1000);
        }

        /* --- PROFILE DROPDOWN FUNCTIONS --- */

        window.toggleDropdown = function () {
            if (profileDropdown.style.display === 'block') {
                profileDropdown.style.display = 'none';
            } else {
                profileDropdown.style.display = 'block';
            }
        }

        window.closeDropdown = function () {
            profileDropdown.style.display = 'none';
        }

        window.handleSignOut = function () {
            toggleHeaderControls(false);
            closeDropdown();
            showMessage('Signed out successfully.');
            user.profilePicUrl = null; // Reset profile picture
            user.name = "John Student"; // Reset name
            updateProfileIcon(); // Reset icon to default
            openAuthModal();
        }

        /**
         * Updates the fixed profile icon with either the uploaded image or the default icon.
         */
        function updateProfileIcon() {
            if (user.profilePicUrl) {
                profileIcon.innerHTML = `<img src="${user.profilePicUrl}" alt="Profile Picture" class="w-full h-full object-cover rounded-full">`;
            } else {
                profileIcon.innerHTML = `<i class="fas fa-user text-primary-color text-lg"></i>`;
            }
            // Update dropdown header info
            dropdownUsernameEl.textContent = user.name;
        }

        /* --- SETTINGS MODAL FUNCTIONS --- */

        window.openSettingsModal = function () {
            settingsModal.style.display = 'flex';
            body.style.overflow = 'hidden';
            profileMessageEl.textContent = '';

            // Set initial form values based on simulation data
            document.getElementById('full-name').value = user.name === "John Student" ? '' : user.name;
            // Reset profile picture display in modal
            if (user.profilePicUrl) {
                profilePicDisplay.innerHTML = `<img src="${user.profilePicUrl}" alt="Profile Picture" class="w-full h-full object-cover rounded-full">`;
            } else {
                profilePicDisplay.innerHTML = `<i class="fas fa-camera text-gray-600 text-xl"></i>`;
            }
        }

        window.closeSettingsModal = function () {
            settingsModal.style.display = 'none';
            body.style.overflow = 'auto';
        }

        function previewProfilePicture(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    // Update display in modal
                    profilePicDisplay.innerHTML = `<img src="${e.target.result}" alt="Profile Picture" class="w-full h-full object-cover rounded-full">`;
                    // Store URL globally
                    user.profilePicUrl = e.target.result; // Store for updating the fixed icon
                };
                reader.readAsDataURL(file);
            }
        }

        function saveProfile(e) {
            e.preventDefault();

            // Get updated name and store it
            user.name = document.getElementById('full-name').value.trim() || "John Student";

            profileMessageEl.textContent = 'Saving profile changes...';
            profileMessageEl.className = 'text-center mt-4 text-sm text-blue-600';

            setTimeout(() => {
                profileMessageEl.textContent = 'Profile Updated Successfully (Simulated)!';
                profileMessageEl.className = 'text-center mt-4 text-sm text-green-600';

                // Update fixed icon on homepage and dropdown
                updateProfileIcon();

                setTimeout(closeSettingsModal, 1500);
            }, 1500);
        }

        /* --- CHATBOT MODAL FUNCTIONS --- */

        function openChatbotModal() {
            chatbotModal.style.display = 'flex';
            body.style.overflow = 'hidden';
        }

        function closeChatbotModal() {
            chatbotModal.style.display = 'none';
            body.style.overflow = 'auto';
        }

        function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const message = input.value.trim();

            if (!message) return;

            // 1. Add user message
            chatHistory.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-blue-600 text-white p-3 rounded-xl rounded-br-none max-w-[80%] shadow-md text-sm">
                        ${message}
                    </div>
                </div>
            `;

            // 2. Add loading indicator
            chatHistory.innerHTML += `
                <div id="ai-typing" class="flex justify-start">
                    <div class="bg-indigo-100 text-indigo-800 p-3 rounded-xl rounded-bl-none max-w-[80%] shadow-sm text-sm">
                        <i class="fas fa-ellipsis-h animate-pulse"></i>
                    </div>
                </div>
            `;
            chatHistory.scrollTop = chatHistory.scrollHeight;
            input.value = '';

            // 3. Simulate AI response
            setTimeout(() => {
                const aiTyping = document.getElementById('ai-typing');
                if (aiTyping) aiTyping.remove();

                let reply = "I'm the CampusAI Assistant! Try asking me about **'Study Tips'**, **'Clubs'**, or **'Campus Hours'**.";
                const lowMsg = message.toLowerCase();

                if (lowMsg.includes('hours') || lowMsg.includes('open') || lowMsg.includes('close')) {
                    reply = "The main campus **library** is open from **8 AM to 10 PM** on weekdays, and 10 AM to 6 PM on weekends. Cafeteria hours are 7 AM - 9 PM.";
                } else if (lowMsg.includes('study') || lowMsg.includes('tip') || lowMsg.includes('advice')) {
                    reply = "To study effectively, try the **Pomodoro Technique** (25 min work / 5 min break) and review your notes daily! Don't forget to use the 'Focus Enhancement' tool.";
                } else if (lowMsg.includes('hello') || lowMsg.includes('hi')) {
                    reply = `Hello, ${user.name}! I am your CampusAI assistant. How can I assist you with your day?`;
                }
                // NEW LOGIC BRANCHES START
                else if (lowMsg.includes('all club') || lowMsg.includes('club list') || lowMsg.includes('join club')) {
                    let clubList = "Absolutely! We have vibrant clubs in several major categories:<ul>";
                    for (const category in CLUB_DATA) {
                        // Extract category name and first club name
                        const categoryName = category.substring(category.indexOf(' ') + 1);
                        const firstClub = CLUB_DATA[category][0].name;
                        clubList += `<li><strong class="text-indigo-900">${categoryName}</strong>: ${CLUB_DATA[category].length} options, starting with ${firstClub}.</li>`;
                    }
                    clubList += "</ul>You can browse them all or get **AI matches** through the 'Events & Clubs' feature card!";
                    reply = clubList;
                }
                else if (lowMsg.includes('event') || lowMsg.includes('upcoming')) {
                    reply = "Here are a few **upcoming campus highlights**:<ul><li>**Nov 15:** Tech Titans Hackathon finals in Block 4 Auditorium.</li><li>**Nov 22:** Literary Circle Poetry Slam at the Central Cafe.</li><li>**Nov 28:** EcoVision Club's Campus Cleanup Drive.</li></ul>Check the 'Events & Clubs' feature card for the full calendar!";
                }
                else if (lowMsg.includes('homework') || lowMsg.includes('assignment') || lowMsg.includes('project')) {
                    reply = "I recommend you break down that task into small steps! Use the **'AI-Powered Tasks'** feature to add your homework, set it as **high priority**, and organize your project milestones.";
                }
                else if (lowMsg.includes('campus life') || lowMsg.includes('food') || lowMsg.includes('dorm')) {
                    reply = "Campus life is vibrant! Are you looking for **cafeteria hours**, **hostel visitor rules**, or the best place for late-night study? Just ask me specifically about those topics!";
                }
                // NEW LOGIC BRANCHES END


                chatHistory.innerHTML += `
                    <div class="flex justify-start">
                        <div class="bg-indigo-100 text-indigo-800 p-3 rounded-xl rounded-bl-none max-w-[80%] shadow-sm text-sm">
                            ${reply}
                        </div>
                    </div>
                `;
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }, 1500);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            // Set initial state: not logged in, hide profile icon
            toggleHeaderControls(false);

            // Load content into the static dashboard card
            loadDashboardContent();

            // Open Auth Modal immediately as requested
            openAuthModal();
        });
    </script>

</body>

</html>
